<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Meeti Soluções</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:700,400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Nunito:400,600&display=swap" rel="stylesheet">
    <link rel="icon" href="{{ url_for('static', filename='img/logo-meeti.jpg') }}" type="image/x-icon">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script>
        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        }
        window.onload = function() {
            if (localStorage.getItem('theme') === 'dark') {
                document.documentElement.classList.add('dark');
            }
            atualizarCamposCidadeEstado();
        }
        function mostraSpinner() {
            document.getElementById('loading-spinner').style.display = 'block';
        }
        function atualizarCamposCidadeEstado() {
            var cep = document.getElementById('cep').value.trim();
            var cidade = document.getElementById('cidade');
            var estado = document.getElementById('estado');
            var cepTemValor = cep.length > 0;
            cidade.disabled = cepTemValor;
            estado.disabled = cepTemValor;
            if (cepTemValor) {
                cidade.value = '';
                estado.selectedIndex = 0;
            }
        }
        document.addEventListener('DOMContentLoaded', function() {
            var cepInput = document.getElementById('cep');
            cepInput.addEventListener('input', atualizarCamposCidadeEstado);
            cepInput.addEventListener('change', atualizarCamposCidadeEstado);
        });
        function copiarTexto(texto, msgSucesso, msgErro) {
            if (!navigator.clipboard) {
                alert(msgErro); return;
            }
            navigator.clipboard.writeText(texto).then(function () {
                alert(msgSucesso);
            }, function () {
                alert(msgErro);
            });
        }
        function copiarCodigos() {
            var trs = document.querySelectorAll('#result-table tr');
            var codigos = [];
            for (var i = 1; i < trs.length; i++) {
                var tds = trs[i].querySelectorAll('td');
                if (tds.length >= 3) {
                    codigos.push(tds[2].textContent.trim());
                }
            }
            if (codigos.length === 0) {
                alert('Nenhum código para copiar.');
                return;
            }
            copiarTexto(codigos.join('\n'), 'Coluna "Código IBGE" copiada!', 'Erro ao copiar.');
        }
        function copiarCompleto() {
            var linhas = [];
            var trs = document.querySelectorAll('#result-table tr');
            for (var i = 1; i < trs.length; i++) {
                var tds = trs[i].querySelectorAll('td');
                if (tds.length >= 3) {
                    var cidade = tds[0].textContent.trim();
                    var uf = tds[1].textContent.trim();
                    var codigoOuErro = tds[2].textContent.trim();
                    linhas.push(cidade + '\t' + uf + '\t' + codigoOuErro);
                }
            }
            if (linhas.length === 0) {
                alert('Nenhum resultado para copiar.');
                return;
            }
            copiarTexto(linhas.join('\n'), 'Resultados completos copiados!', 'Erro ao copiar resultados.');
        }
    </script>
</head>
<body>
    <div class="topbar">
        <span class="brand-logo-wrap">
            <img class="brand-logo" src="data:image/jpeg;base64,{{ logo_data }}" alt="Logo Meeti" />
            <div class="title-underline"></div>
            <div class="brand-subtitle">Encontre a solução perfeita para a sua empresa.</div>
            <a class="brand-contact-link" href="https://meetisolucoes.com.br/" target="_blank" rel="noopener">Entre em contato</a>
        </span>
        <button class="dark-toggle-btn" onclick="toggleTheme()" title="Alternar tema">🌓 Tema</button>
    </div>
    <div class="central-container">
        <div class="container">

            <div id="loading-spinner">
                <svg width="48" height="48" viewBox="0 0 48 48" style="margin:18px auto;display:block" xmlns="http://www.w3.org/2000/svg" fill="none">
                    <circle cx="24" cy="24" r="20" stroke="#276ef1" stroke-width="5" stroke-opacity="0.22"/>
                    <path d="M44 24a20 20 0 0 1-20 20" stroke="#276ef1" stroke-width="5" stroke-linecap="round">
                        <animateTransform attributeName="transform" type="rotate" from="0 24 24" to="360 24 24" dur="0.9s" repeatCount="indefinite"/>
                    </path>
                </svg>
                <span>Buscando informações...</span>
            </div>

            <h2>Consultar Código IBGE das Cidades</h2>
            <div class="motivation">Atualize seus cadastros de forma rápida e precisa</div>
            <form action="/consultar" method="post" onsubmit="mostraSpinner()">
                <label for="cep">Digite um ou mais CEPs (um por linha):</label>
                <textarea id="cep" name="cep" rows="4" placeholder="Exemplo: 12345678
87654321">{{ cep|default('') }}</textarea>
                <label for="cidade">Digite uma ou mais cidades (um por linha):</label>
                <textarea id="cidade" name="cidade" rows="7" placeholder="Exemplo:
Florianópolis
Joinville">{{ cidades|default('') }}</textarea>
                <label for="estado">Estado (UF) (opcional):</label>
                <select id="estado" name="estado">
                    <option value="" {% if not estado %}selected{% endif %}>-- Não informar --</option>
                    {% for uf in ['AC','AL','AP','AM','BA','CE','DF','ES','GO','MA','MT','MS','MG','PA','PB','PR','PE','PI','RJ','RN','RS','RO','RR','SC','SP','SE','TO'] %}
                    <option value="{{ uf }}" {% if estado == uf %}selected{% endif %}>{{ uf }}</option>
                    {% endfor %}
                </select>
                <input type="submit" value="Consultar" />
            </form>
            {% if erro %}
            <div class="error">{{ erro }}</div>
            {% endif %}
            {% if resultados %}
            <div class="result">
                <h3>Resultados</h3>
                <table id="result-table">
                    <tr>
                        <th>Cidade</th>
                        <th>Estado</th>
                        <th>Código IBGE</th>
                    </tr>
                    {% for r in resultados %}
                        {% if r.codigo %}
                            <tr>
                                <td>{{ r.input }}</td>
                                <td>{{ r.uf }}</td>
                                <td><b class="only-code">{{ r.codigo }}</b></td>
                            </tr>
                        {% elif r.multiplos %}
                            {% for m in r.multiplos %}
                                <tr>
                                    <td>{{ m.nome }}</td>
                                    <td>{{ m.uf }}</td>
                                    <td><b class="only-code">{{ m.id }}</b></td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td>{{ r.input }}</td>
                                <td>-</td>
                                <td style="color:#b94a4a;">{{ r.erro }}</td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                </table>
                <button class="copy-codes-btn" onclick="copiarCodigos()">Copiar códigos IBGE</button>
                <button class="copy-full-btn" onclick="copiarCompleto()">Copiar resultado completo</button>
            </div>
            {% endif %}
        </div>
    </div>
    <span class="footer-credit">Criado por Ritcheli Gomes.</span>
</body>
</html>
